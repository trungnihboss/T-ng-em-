<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Love 3D Mobile</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      touch-action: none;
      background: #000;
    }
    canvas {
      display: block;
    }
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      width: 80%;
    }
    #error {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: red;
      font-family: Arial, sans-serif;
      text-align: center;
      width: 80%;
    }
  </style>
</head>
<body>
  <div id="loading">Đang tải ứng dụng tình yêu...</div>
  <div id="error"></div>

  <!-- Three.js từ CDN -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  
  <script>
    // Kiểm tra WebGL và mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const errorElement = document.getElementById('error');
    const loadingElement = document.getElementById('loading');

    if (!WEBGL.isWebGLAvailable()) {
      errorElement.style.display = 'block';
      errorElement.innerHTML = 'Thiết bị không hỗ trợ WebGL<br>Vui lòng dùng trình duyệt Chrome/Firefox mới nhất';
      loadingElement.style.display = 'none';
      throw new Error('WebGL not supported');
    }

    // Giảm chất lượng đồ họa trên mobile
    const quality = isMobile ? 0.5 : 1;

    // Khởi tạo scene
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);
    
    // Camera phù hợp với mobile
    const camera = new THREE.PerspectiveCamera(
      60, 
      window.innerWidth / window.innerHeight, 
      0.1, 
      1000
    );
    camera.position.z = isMobile ? 40 : 60;
    
    // Renderer tối ưu cho mobile
    const renderer = new THREE.WebGLRenderer({
      antialias: true,
      powerPreference: isMobile ? "low-power" : "high-performance"
    });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Ánh sáng đơn giản hơn cho mobile
    const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
    directionalLight.position.set(1, 1, 1).normalize();
    scene.add(directionalLight);

    // Tạo trái tim đơn giản
    const createHeart = () => {
      const shape = new THREE.Shape();
      shape.moveTo(0, 0);
      shape.bezierCurveTo(0, 0, -2, -3, 0, -5);
      shape.bezierCurveTo(2, -3, 0, 0, 0, 0);
      
      const geometry = new THREE.ExtrudeGeometry(shape, {
        depth: 0.5,
        bevelEnabled: false // Tắt bevel để tối ưu
      });
      
      const material = new THREE.MeshPhongMaterial({
        color: 0xff3366,
        transparent: true,
        opacity: 0.9
      });
      
      return new THREE.Mesh(geometry, material);
    };

    // Tạo các trái tim bay
    const hearts = [];
    const heartCount = isMobile ? 15 : 30;
    
    for (let i = 0; i < heartCount; i++) {
      const heart = createHeart();
      heart.scale.set(0.3, 0.3, 0.3);
      heart.position.set(
        (Math.random() - 0.5) * 60,
        (Math.random() - 0.5) * 60,
        (Math.random() - 0.5) * 60
      );
      heart.velocity = new THREE.Vector3(
        (Math.random() - 0.5) * 0.3,
        (Math.random() - 0.5) * 0.3,
        (Math.random() - 0.5) * 0.3
      );
      hearts.push(heart);
      scene.add(heart);
    }

    // Text đơn giản (không dùng font 3D để tối ưu)
    const texts = [
      "Anh Trung ❤ Anh Thư",
      "Mãi yêu em",
      "1 Year Together",
      "Love you forever"
    ];
    
    const createText = (message) => {
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = 512;
      canvas.height = 256;
      context.font = "Bold 40px Arial";
      context.fillStyle = "rgba(255,51,102,0.8)";
      context.textAlign = "center";
      context.fillText(message, canvas.width/2, canvas.height/2);
      
      const texture = new THREE.CanvasTexture(canvas);
      const material = new THREE.SpriteMaterial({ map: texture });
      const sprite = new THREE.Sprite(material);
      sprite.scale.set(10, 5, 1);
      
      return sprite;
    };
    
    // Thêm text vào scene
    texts.forEach((text, i) => {
      const textSprite = createText(text);
      textSprite.position.set(
        (Math.random() - 0.5) * 80,
        (Math.random() - 0.5) * 80,
        (Math.random() - 0.5) * 80
      );
      scene.add(textSprite);
    });

    // Xử lý resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Ẩn loading khi tải xong
    loadingElement.style.display = 'none';

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      
      // Di chuyển trái tim
      hearts.forEach(heart => {
        heart.position.add(heart.velocity);
        heart.rotation.y += 0.01;
        
        // Giới hạn di chuyển
        ['x', 'y', 'z'].forEach(axis => {
          if (Math.abs(heart.position[axis]) > 50) {
            heart.velocity[axis] *= -1;
          }
        });
      });
      
      renderer.render(scene, camera);
    }
    
    animate();
  </script>
</body>
</html>
