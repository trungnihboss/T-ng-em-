<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thế giới chữ 3D của Thư 💖</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(ellipse at center, #111, #000);
      height: 100%;
      touch-action: none;
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>

<canvas id="world"></canvas>

<script>
  const canvas = document.getElementById("world");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let W = canvas.width;
  let H = canvas.height;

  const phrases = [
    "Thư siêu xinh đẹp 💖", "Món quà nhỏ 🎁", "Lấp lánh ✨", "Bạn là mặt trời 🌞",
    "Cute vô cực 🐰", "Ngôi sao trong đêm 🌟", "Thế giới của bạn 🌍", "Dễ thương nhất vũ trụ 💫"
  ];

  const dots = [];
  const total = 250;
  const radius = 500;

  let angleX = 0;
  let angleY = 0;

  for (let i = 0; i < total; i++) {
    const theta = Math.random() * 2 * Math.PI;
    const phi = Math.acos(2 * Math.random() - 1);

    const x = radius * Math.sin(phi) * Math.cos(theta);
    const y = radius * Math.sin(phi) * Math.sin(theta);
    const z = radius * Math.cos(phi);
    const word = phrases[Math.floor(Math.random() * phrases.length)];

    dots.push({ x, y, z, word, speed: 0.5 + Math.random() * 1.5 });
  }

  function project(x, y, z) {
    const scale = 800 / (800 + z);
    const projX = x * scale + W / 2;
    const projY = y * scale + H / 2;
    return { x: projX, y: projY, scale };
  }

  function rotateX3D(p, angle) {
    const cos = Math.cos(angle);
    const sin = Math.sin(angle);
    const y = p.y * cos - p.z * sin;
    const z = p.z * cos + p.y * sin;
    return { x: p.x, y, z, word: p.word, speed: p.speed };
  }

  function rotateY3D(p, angle) {
    const cos = Math.cos(angle);
    const sin = Math.sin(angle);
    const x = p.x * cos - p.z * sin;
    const z = p.z * cos + p.x * sin;
    return { x, y: p.y, z, word: p.word, speed: p.speed };
  }

  function render() {
    ctx.clearRect(0, 0, W, H);

    for (let i = 0; i < dots.length; i++) {
      let p = dots[i];

      // Rơi từ từ (theo hướng y)
      p.y += p.speed;
      if (p.y > radius) p.y = -radius;

      // Xoay toàn cầu
      p = rotateX3D(p, angleX);
      p = rotateY3D(p, angleY);
      dots[i] = p;

      const proj = project(p.x, p.y, p.z);
      ctx.save();
      ctx.translate(proj.x, proj.y);
      ctx.scale(proj.scale, proj.scale);
      ctx.fillStyle = "rgba(255, 182, 193, 0.9)";
      ctx.font = "bold 20px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText(p.word, 0, 0);
      ctx.restore();
    }

    requestAnimationFrame(render);
  }

  render();

  // Điều khiển xoay bằng chuột hoặc chạm
  let isDragging = false, lastX, lastY;

  canvas.addEventListener("mousedown", (e) => {
    isDragging = true;
    lastX = e.clientX;
    lastY = e.clientY;
  });

  canvas.addEventListener("mousemove", (e) => {
    if (!isDragging) return;
    let dx = e.clientX - lastX;
    let dy = e.clientY - lastY;
    angleY += dx * 0.005;
    angleX += dy * 0.005;
    lastX = e.clientX;
    lastY = e.clientY;
  });

  canvas.addEventListener("mouseup", () => isDragging = false);

  // Cho cảm ứng
  canvas.addEventListener("touchstart", (e) => {
    isDragging = true;
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  });

  canvas.addEventListener("touchmove", (e) => {
    if (!isDragging) return;
    let dx = e.touches[0].clientX - lastX;
    let dy = e.touches[0].clientY - lastY;
    angleY += dx * 0.005;
    angleX += dy * 0.005;
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  });

  canvas.addEventListener("touchend", () => isDragging = false);

  window.addEventListener("resize", () => {
    canvas.width = W = window.innerWidth;
    canvas.height = H = window.innerHeight;
  });
</script>

</body>
</html>
